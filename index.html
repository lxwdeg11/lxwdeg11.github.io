<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>莫失莫忘的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="莫失莫忘的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="莫失莫忘的博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="莫失莫忘的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">莫失莫忘的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-安卓存储栈" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/06/09/%E5%AE%89%E5%8D%93%E5%AD%98%E5%82%A8%E6%A0%88/" class="article-date">
  <time datetime="2022-06-09T13:35:01.000Z" itemprop="datePublished">2022-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/06/09/%E5%AE%89%E5%8D%93%E5%AD%98%E5%82%A8%E6%A0%88/">安卓存储栈</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="安卓软件栈"><a href="#安卓软件栈" class="headerlink" title="安卓软件栈"></a>安卓软件栈</h3><p><img src="/img/bVcZ1ba" alt="image.png"></p>
<h3 id="framework层"><a href="#framework层" class="headerlink" title="framework层"></a>framework层</h3><p>StorageManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frameworks/base/core/java/android/os/storage/StorageManager.java</span><br></pre></td></tr></table></figure>

<h3 id="java-libcore"><a href="#java-libcore" class="headerlink" title="java libcore"></a>java libcore</h3><blockquote>
<p>According to this slide deck from 2016, Libcore is Google’s implementation of some core Java libraries such as java.net, java.util, java.icu (Unicode), java.math, java.reflect, and possibly more. Libcore also allows for POSIX system calls from Java.Libcore’s master branch can be found here. Most of Google’s implementation is found in folder luni , but libcore also mixes with Oracle code. For example, Oracle’s JNI implementation from OpenJDK is used in Android in folder ojluni. So libcore replaces some functionality from OpenJDK, but not all.<br><strong>有个java.io.file在路径：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libcore/ojluni/src/main/java/java/io/File.java</span><br></pre></td></tr></table></figure>
<p><strong>framework层是调用上面的这个File.java类吗？不是？</strong></p>
<p>里面有文件相关操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public boolean createNewFile() throws IOException &#123;</span><br><span class="line">        SecurityManager security = System.getSecurityManager();</span><br><span class="line">        if (security != null) security.checkWrite(path);</span><br><span class="line">        if (isInvalid()) &#123;</span><br><span class="line">            throw new IOException(&quot;Invalid file path&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return fs.createFileExclusively(path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">/* -- File operations -- */</span><br><span class="line">    // Android-changed: Add method to intercept native method call; BlockGuard support.</span><br><span class="line">    public boolean createFileExclusively(String path) throws IOException &#123;</span><br><span class="line">        BlockGuard.getThreadPolicy().onWriteToDisk();</span><br><span class="line">        BlockGuard.getVmPolicy().onPathAccess(path);</span><br><span class="line">        return createFileExclusively0(path);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><em><strong>这里是C语言实现的给java调用的createFileExclusively0 JNI接口：</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">libcore/ojluni/src/main/native/UnixFileSystem_md.c：</span><br><span class="line"></span><br><span class="line">// Android-changed: Name changed because of added thread policy check</span><br><span class="line">JNIEXPORT jboolean JNICALL</span><br><span class="line">Java_java_io_UnixFileSystem_createFileExclusively0(JNIEnv *env, jclass cls,</span><br><span class="line">                                                   jstring pathname)</span><br><span class="line">&#123;</span><br><span class="line">    jboolean rv = JNI_FALSE;</span><br><span class="line"></span><br><span class="line">    WITH_PLATFORM_STRING(env, pathname, path) &#123;</span><br><span class="line">        FD fd;</span><br><span class="line">        /* The root directory always exists */</span><br><span class="line">        if (strcmp (path, &quot;/&quot;)) &#123;</span><br><span class="line">            fd = handleOpen(path, O_RDWR | O_CREAT | O_EXCL, 0666);</span><br><span class="line">            if (fd &lt; 0) &#123;</span><br><span class="line">                if (errno != EEXIST)</span><br><span class="line">                    JNU_ThrowIOExceptionWithLastError(env, path);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                if (close(fd) == -1)</span><br><span class="line">                    JNU_ThrowIOExceptionWithLastError(env, path);</span><br><span class="line">                rv = JNI_TRUE;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; END_PLATFORM_STRING(env, path);</span><br><span class="line">    return rv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">libcore/ojluni/src/main/native/io_util_md.c：</span><br><span class="line">FD</span><br><span class="line">handleOpen(const char *path, int oflag, int mode) &#123;</span><br><span class="line">    FD fd;</span><br><span class="line">    RESTARTABLE(open64(path, oflag, mode), fd);</span><br><span class="line">    if (fd != -1) &#123;</span><br><span class="line">        struct stat64 buf64;</span><br><span class="line">        int result;</span><br><span class="line">        RESTARTABLE(fstat64(fd, &amp;buf64), result);</span><br><span class="line">        if (result != -1) &#123;</span><br><span class="line">            if (S_ISDIR(buf64.st_mode)) &#123;</span><br><span class="line">                close(fd);</span><br><span class="line">                errno = EISDIR;</span><br><span class="line">                fd = -1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            close(fd);</span><br><span class="line">            fd = -1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bionic/libc/include/bits/fortify/fcntl.h：</span><br><span class="line">__BIONIC_FORTIFY_INLINE</span><br><span class="line">int open64(const char* const __pass_object_size pathname, int flags, mode_t modes)</span><br><span class="line">        __overloadable</span><br><span class="line">        __clang_warning_if(!__open_modes_useful(flags) &amp;&amp; modes,</span><br><span class="line">                           &quot;&#x27;open64&#x27; &quot; __open_useless_modes_warning) &#123;</span><br><span class="line">    return open(pathname, flags, modes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__BIONIC_FORTIFY_INLINE</span><br><span class="line">int open(const char* const __pass_object_size pathname, int flags, mode_t modes)</span><br><span class="line">        __overloadable</span><br><span class="line">        __clang_warning_if(!__open_modes_useful(flags) &amp;&amp; modes,</span><br><span class="line">                           &quot;&#x27;open&#x27; &quot; __open_useless_modes_warning) &#123;</span><br><span class="line">    return __open_real(pathname, flags, modes);</span><br><span class="line">&#125;</span><br><span class="line">int __open_real(const char*, int, ...) __RENAME(open);</span><br><span class="line"></span><br><span class="line">bionic/libc/include/sys/cdefs.h：</span><br><span class="line">#define __RENAME(x) __asm__(#x)</span><br></pre></td></tr></table></figure>
<p>看这两个文件：<br>libcore\luni\src\main\native\libcore_io_Posix.cpp<br>libcore\luni\src\main\native\libcore_io_Linux.cpp</p>
<p>另外一个类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">frameworks/base/core/java/android/content/ContextWrapper.java：</span><br><span class="line">public class ContextWrapper extends Context &#123;</span><br><span class="line">    @UnsupportedAppUsage</span><br><span class="line">    Context mBase;</span><br><span class="line"></span><br><span class="line">    public ContextWrapper(Context base) &#123;</span><br><span class="line">        mBase = base;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public FileInputStream openFileInput(String name)</span><br><span class="line">            throws FileNotFoundException &#123;</span><br><span class="line">        return mBase.openFileInput(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">frameworks/base/core/java/android/app/ContextImpl.java：</span><br><span class="line"> @Override</span><br><span class="line">    public FileInputStream openFileInput(String name)</span><br><span class="line">        throws FileNotFoundException &#123;</span><br><span class="line">        File f = makeFilename(getFilesDir(), name);</span><br><span class="line">        return new FileInputStream(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">这个对象FileInputStream：</span><br><span class="line">public FileInputStream(String name)</span><br><span class="line">                throws FileNotFoundException</span><br><span class="line">Creates a FileInputStream by opening a connection to an actual file, the file named by the path name name in the file system. A new FileDescriptor object is created to represent this file connection.</span><br><span class="line">其中的几个方法：</span><br><span class="line">public int read() 从输入流读一个字节的数据</span><br><span class="line">         throws IOException</span><br><span class="line">Reads a byte of data from this input stream. This method blocks if no input is yet available.</span><br><span class="line"></span><br><span class="line">public int read(byte[] b)</span><br><span class="line">         throws IOException</span><br><span class="line">Reads up to b.length bytes of data from this input stream into an array of bytes. This method blocks until some input is available.</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">     * Reads up to &lt;code&gt;len&lt;/code&gt; bytes of data from this input stream</span><br><span class="line">     * into an array of bytes. If &lt;code&gt;len&lt;/code&gt; is not zero, the method</span><br><span class="line">     * blocks until some input is available; otherwise, no</span><br><span class="line">     * bytes are read and &lt;code&gt;0&lt;/code&gt; is returned.</span><br><span class="line">     *</span><br><span class="line">     * @param      b     the buffer into which the data is read.</span><br><span class="line">     * @param      off   the start offset in the destination array &lt;code&gt;b&lt;/code&gt;</span><br><span class="line">     * @param      len   the maximum number of bytes read.</span><br><span class="line">     * @return     the total number of bytes read into the buffer, or</span><br><span class="line">     *             &lt;code&gt;-1&lt;/code&gt; if there is no more data because the end of</span><br><span class="line">     *             the file has been reached.</span><br><span class="line">     * @exception  NullPointerException If &lt;code&gt;b&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.</span><br><span class="line">     * @exception  IndexOutOfBoundsException If &lt;code&gt;off&lt;/code&gt; is negative,</span><br><span class="line">     * &lt;code&gt;len&lt;/code&gt; is negative, or &lt;code&gt;len&lt;/code&gt; is greater than</span><br><span class="line">     * &lt;code&gt;b.length - off&lt;/code&gt;</span><br><span class="line">     * @exception  IOException  if an I/O error occurs.</span><br><span class="line">     */</span><br><span class="line">    public int read(byte b[], int off, int len) throws IOException &#123;</span><br><span class="line">        // Android-added: close() check before I/O.</span><br><span class="line">        if (closed &amp;&amp; len &gt; 0) &#123;</span><br><span class="line">            throw new IOException(&quot;Stream Closed&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Android-added: Tracking of unbuffered I/O.</span><br><span class="line">        tracker.trackIo(len, IoTracker.Mode.READ);</span><br><span class="line"></span><br><span class="line">        // Android-changed: Use IoBridge instead of calling native method.</span><br><span class="line">        return IoBridge.read(fd, b, off, len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">libcore/ojluni/src/main/native/io_util.c:</span><br><span class="line"></span><br><span class="line">jint</span><br><span class="line">readBytes(JNIEnv *env, jobject this, jbyteArray bytes,</span><br><span class="line">          jint off, jint len, jfieldID fid)</span><br><span class="line">&#123;</span><br><span class="line">    jint nread;</span><br><span class="line">    char stackBuf[BUF_SIZE];</span><br><span class="line">    char *buf = NULL;</span><br><span class="line">    FD fd;</span><br><span class="line"></span><br><span class="line">    if (IS_NULL(bytes)) &#123;</span><br><span class="line">        JNU_ThrowNullPointerException(env, NULL);</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (outOfBounds(env, off, len, bytes)) &#123;</span><br><span class="line">        JNU_ThrowByName(env, &quot;java/lang/IndexOutOfBoundsException&quot;, NULL);</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (len == 0) &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125; else if (len &gt; BUF_SIZE) &#123;</span><br><span class="line">        buf = malloc(len);</span><br><span class="line">        if (buf == NULL) &#123;</span><br><span class="line">            JNU_ThrowOutOfMemoryError(env, NULL);</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        buf = stackBuf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fd = GET_FD(this, fid);</span><br><span class="line">    if (fd == -1) &#123;</span><br><span class="line">        JNU_ThrowIOException(env, &quot;Stream Closed&quot;);</span><br><span class="line">        nread = -1;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        nread = (jint)IO_Read(fd, buf, len);</span><br><span class="line">        if (nread &gt; 0) &#123;</span><br><span class="line">            (*env)-&gt;SetByteArrayRegion(env, bytes, off, nread, (jbyte *)buf);</span><br><span class="line">        &#125; else if (nread == JVM_IO_ERR) &#123;</span><br><span class="line">            JNU_ThrowIOExceptionWithLastError(env, &quot;Read error&quot;);</span><br><span class="line">        &#125; else if (nread == JVM_IO_INTR) &#123;</span><br><span class="line">            JNU_ThrowByName(env, &quot;java/io/InterruptedIOException&quot;, NULL);</span><br><span class="line">        &#125; else &#123; /* EOF */</span><br><span class="line">            nread = -1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (buf != stackBuf) &#123;</span><br><span class="line">        free(buf);</span><br><span class="line">    &#125;</span><br><span class="line">    return nread;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">libcore/ojluni/src/main/native/io_util_md.h:</span><br><span class="line">#define IO_Read JVM_Read</span><br><span class="line"></span><br><span class="line">art/openjdkjvm/OpenjdkJvm.cc:</span><br><span class="line">/* posix read() */</span><br><span class="line">JNIEXPORT jint JVM_Read(jint fd, char* buf, jint nbytes) &#123;</span><br><span class="line">    return TEMP_FAILURE_RETRY(read(fd, buf, nbytes));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>






<h3 id="libc库"><a href="#libc库" class="headerlink" title="libc库"></a>libc库</h3><p>源码位置：<br><code>bionic/libc/stdio/stdio.cpp</code></p>
<p>上层不一定调用fopen，可能直接调open系统调用。<br>例如fopen：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FILE* fopen(const char* file, const char* mode) &#123;</span><br><span class="line">  int mode_flags;</span><br><span class="line">  int flags = __sflags(mode, &amp;mode_flags);</span><br><span class="line">  if (flags == 0) return nullptr;</span><br><span class="line"></span><br><span class="line">  int fd = open(file, mode_flags, DEFFILEMODE);</span><br><span class="line">  if (fd == -1) &#123;</span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  FILE* fp = __FILE_init(__sfp(), fd, flags);</span><br><span class="line">  if (fp == nullptr) &#123;</span><br><span class="line">    ErrnoRestorer errno_restorer;</span><br><span class="line">    close(fd);</span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>里面的open就会最终调用到open系统调用。<br>libc里面调用的系统调用，根据这个文件里的系统调用列表，会用python脚本生成头文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">https://android.googlesource.com/platform/bionic/+/refs/heads/master/libc/SYSCALLS.TXT</span><br><span class="line"></span><br><span class="line"># This file is used to automatically generate bionic&#x27;s system call stubs.</span><br><span class="line">#</span><br><span class="line"># Each non-blank, non-comment line has the following format:</span><br><span class="line">#</span><br><span class="line"># return_type func_name[|alias_list][:syscall_name[:socketcall_id]]([parameter_list]) arch_list</span><br><span class="line">#</span><br><span class="line"># where:</span><br><span class="line">#       arch_list ::= &quot;all&quot; | arches</span><br><span class="line">#       arches    ::= arch |  arch &quot;,&quot; arches</span><br><span class="line">#       arch      ::= &quot;arm&quot; | &quot;arm64&quot; | &quot;x86&quot; | &quot;x86_64&quot; | &quot;lp32&quot; | &quot;lp64&quot;</span><br><span class="line">#</span><br><span class="line"># Note:</span><br><span class="line">#      - syscall_name corresponds to the name of the syscall, which may differ from</span><br><span class="line">#        the exported function name (example: the exit syscall is implemented by the _exit()</span><br><span class="line">#        function, which is not the same as the standard C exit() function which calls it)</span><br><span class="line">#</span><br><span class="line">#      - alias_list is optional comma separated list of function aliases.</span><br><span class="line">#</span><br><span class="line">#      - The call_id parameter, given that func_name and syscall_name have</span><br><span class="line">#        been provided, allows the user to specify dispatch style syscalls.</span><br><span class="line">#        For example, socket() syscall on i386 actually becomes:</span><br><span class="line">#          socketcall(__NR_socket, 1, *(rest of args on stack)).</span><br><span class="line">#</span><br><span class="line">#      - Each parameter type is assumed to be stored in 32 bits.</span><br><span class="line">#</span><br><span class="line"># This file is processed by a python script named gensyscalls.py, run via</span><br><span class="line"># genrules in Android.bp.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>引用</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/06/09/%E5%AE%89%E5%8D%93%E5%AD%98%E5%82%A8%E6%A0%88/" data-id="cl472cilf0000dkvk0ufwhatk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Storage/" rel="tag">Storage</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux-kernel-news" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/29/Linux-kernel-news/" class="article-date">
  <time datetime="2022-05-29T03:29:12.000Z" itemprop="datePublished">2022-05-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/29/Linux-kernel-news/">Linux kernel news</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h1><ul>
<li><p>[Linux Storage Linux &amp; Open-Source News - Phoronix](<a target="_blank" rel="noopener" href="https://www.phoronix.com/scan.php?page=news_topic&amp;q=Linux">https://www.phoronix.com/scan.php?page=news_topic&amp;q=Linux</a> Storage) 查看内核storage部分的变化。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://kernelnewbies.org/LinuxVersions">LinuxVersions - Linux Kernel Newbies</a> 查看内核各个版本的差异，其中file system，block layer和drivers的storage跟存储有关。</p>
</li>
<li><p>[LWN.net Weekly Edition Archives <a target="_blank" rel="noopener" href="https://lwn.net/Archives/">LWN.net]</a>, LWN每周的归档，可以查找storage的变化。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/29/Linux-kernel-news/" data-id="cl3qqwrtz0000rwvka8z778x1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kernel/" rel="tag">kernel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/storage/" rel="tag">storage</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python建立socket-server-websocket-server" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/27/python%E5%BB%BA%E7%AB%8Bsocket-server-websocket-server/" class="article-date">
  <time datetime="2022-05-27T10:55:26.000Z" itemprop="datePublished">2022-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/27/python%E5%BB%BA%E7%AB%8Bsocket-server-websocket-server/">python建立socket server(websocket server)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">安装这个库</span><br><span class="line">pip3 install websocket_server</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> websocket_server <span class="keyword">import</span> WebsocketServer</span><br><span class="line"></span><br><span class="line"><span class="comment"># Called for every client connecting (after handshake)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new_client</span>(<span class="params">client, server</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;New client connected and was given id %d&quot;</span> % client[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">    server.send_message_to_all(<span class="string">&quot;Hey all, a new client has joined us&quot;</span>)</span><br><span class="line"><span class="comment"># Called for every client disconnecting</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_left</span>(<span class="params">client, server</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client(%d) disconnected&quot;</span> % client[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line"><span class="comment"># Called when a client sends a message</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">message_received</span>(<span class="params">client, server, message</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(message) &gt; <span class="number">200</span>:</span><br><span class="line">        message = message[:<span class="number">200</span>]+<span class="string">&#x27;..&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client(%d) said: %s&quot;</span> % (client[<span class="string">&#x27;id&#x27;</span>], message))</span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line">server = WebsocketServer(host=<span class="string">&quot;www.lixuewen.ml&quot;</span>, port = <span class="number">10000</span>)</span><br><span class="line">server.set_fn_new_client(new_client)</span><br><span class="line">server.set_fn_client_left(client_left)</span><br><span class="line">server.set_fn_message_received(message_received)</span><br><span class="line">server.run_forever()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/27/python%E5%BB%BA%E7%AB%8Bsocket-server-websocket-server/" data-id="cl3obxdrd0000q8vkcdw016b2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/socket/" rel="tag">socket</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux和Windows上面shell基本操作对比" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/25/Linux%E5%92%8CWindows%E4%B8%8A%E9%9D%A2shell%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%AF%B9%E6%AF%94/" class="article-date">
  <time datetime="2022-05-25T09:16:33.000Z" itemprop="datePublished">2022-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/25/Linux%E5%92%8CWindows%E4%B8%8A%E9%9D%A2shell%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%AF%B9%E6%AF%94/">Linux和Windows上面shell基本操作对比</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th></th>
<th>Linux</th>
<th>Windows</th>
</tr>
</thead>
<tbody><tr>
<td>新建目录</td>
<td>mkdir</td>
<td>mkdir</td>
</tr>
<tr>
<td>查看目录下所有文件及目录</td>
<td>ls</td>
<td>dir</td>
</tr>
<tr>
<td>删除文件</td>
<td>rm</td>
<td>del</td>
</tr>
<tr>
<td>删除目录</td>
<td>rm -r</td>
<td>rmdir folder -s</td>
</tr>
<tr>
<td>历史命令</td>
<td>history</td>
<td>F7</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/25/Linux%E5%92%8CWindows%E4%B8%8A%E9%9D%A2shell%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%AF%B9%E6%AF%94/" data-id="cl3mc19p00000l4vk8pidetug" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nodejs实现wss-secure-websocket-服务器，且浏览器JavaScript实现wss-secure-websocket-客户端与之通信" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/24/nodejs%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E4%B8%94%E6%B5%8F%E8%A7%88%E5%99%A8JavaScript%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E4%B9%8B%E9%80%9A%E4%BF%A1/" class="article-date">
  <time datetime="2022-05-24T14:40:04.000Z" itemprop="datePublished">2022-05-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/24/nodejs%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E4%B8%94%E6%B5%8F%E8%A7%88%E5%99%A8JavaScript%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E4%B9%8B%E9%80%9A%E4%BF%A1/">nodejs实现wss(secure websocket)服务器，且浏览器JavaScript实现wss(secure websocket)客户端与之通信</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>nodejs服务器代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// curl -k https://localhost:8000/</span><br><span class="line">const https = require(&#x27;node:https&#x27;);</span><br><span class="line">const fs = require(&#x27;node:fs&#x27;);</span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  key: fs.readFileSync(&#x27;ssl/server.key&#x27;),</span><br><span class="line">  cert: fs.readFileSync(&#x27;ssl/server.cert&#x27;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">secureServer = https.createServer(options, (req, res) =&gt; &#123;</span><br><span class="line">  res.writeHead(200);</span><br><span class="line">  res.end(&#x27;hello world\n&#x27;);</span><br><span class="line">&#125;).listen(8888);</span><br><span class="line"></span><br><span class="line">secureServer.address().address.replace(&quot;127.0.0.1&quot;, &quot;localhost&quot;)</span><br><span class="line"></span><br><span class="line">var ws = require(&#x27;ws&#x27;).Server;</span><br><span class="line">var wss = new ws(&#123;</span><br><span class="line">    server: secureServer,</span><br><span class="line">    autoAcceptConnections: true</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">wss.on(&#x27;connection&#x27;, function connection(ws) &#123;</span><br><span class="line">  ws.on(&#x27;message&#x27;, function incoming(message) &#123;</span><br><span class="line">    console.log(&#x27;received: %s&#x27;, message);</span><br><span class="line">    const fs = require(&#x27;fs&#x27;)</span><br><span class="line"></span><br><span class="line">    var t = new Date().getTime();</span><br><span class="line">    filename = &#x27;./message/&#x27; + t + &#x27;message.txt&#x27;</span><br><span class="line">   fs.writeFile(filename, message, err =&gt; &#123;</span><br><span class="line">   if (err) &#123;</span><br><span class="line">    console.error(err)</span><br><span class="line">    return</span><br><span class="line">   &#125;</span><br><span class="line">   //文件写入成功。</span><br><span class="line">&#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ws.send(&#x27;something&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>浏览器JavaScript代码：</p>
<p>？？？</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/24/nodejs%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E4%B8%94%E6%B5%8F%E8%A7%88%E5%99%A8JavaScript%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E4%B9%8B%E9%80%9A%E4%BF%A1/" data-id="cl3k9n6d200004cvk7neuc8p2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wss/" rel="tag">wss</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python实现wss-secure-websocket-的服务器和客户端" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/24/python%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF/" class="article-date">
  <time datetime="2022-05-24T14:36:03.000Z" itemprop="datePublished">2022-05-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/24/python%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF/">python实现wss(secure websocket)的服务器和客户端</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>生成密钥</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -newkey rsa:<span class="number">2048</span> -new -nodes -x509 -days <span class="number">3650</span> -keyout key.pem -out cert.pem</span><br></pre></td></tr></table></figure></li>
<li><p>python服务器端代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># WSS (WS over TLS) server example, with a self-signed certificate</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">websocket, path</span>):</span><br><span class="line">    name = <span class="keyword">await</span> websocket.recv()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;&lt; <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    greeting = <span class="string">f&quot;Hello <span class="subst">&#123;name&#125;</span>!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> websocket.send(greeting)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;&gt; <span class="subst">&#123;greeting&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)</span><br><span class="line"><span class="comment">#localhost_pem = pathlib.Path(__file__).with_name(&quot;localhost.pem&quot;)</span></span><br><span class="line"><span class="comment">#ssl_context.load_cert_chain(localhost_pem)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#start_server = websockets.serve(</span></span><br><span class="line"> <span class="comment">#   hello, &quot;localhost&quot;, 8765, ssl=ssl_context</span></span><br><span class="line"><span class="comment">#)</span></span><br><span class="line"></span><br><span class="line">path_cert = pathlib.Path(__file__).with_name(<span class="string">&quot;cert.pem&quot;</span>)</span><br><span class="line">path_key = pathlib.Path(__file__).with_name(<span class="string">&quot;key.pem&quot;</span>)</span><br><span class="line">ssl_context.load_cert_chain(path_cert, keyfile=path_key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Listening for connection...&quot;</span>)</span><br><span class="line">start_server = websockets.serve(hello, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8765</span>, ssl=ssl_context)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(start_server)</span><br><span class="line">asyncio.get_event_loop().run_forever()</span><br></pre></td></tr></table></figure></li>
<li><p>python客户端代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># WSS (WS over TLS) client example, with a self-signed certificate</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"></span><br><span class="line"><span class="comment">#ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)</span></span><br><span class="line"><span class="comment">#ssl_context.load_verify_locations(</span></span><br><span class="line"> <span class="comment">#   pathlib.Path(__file__).with_name(&#x27;server.pem&#x27;))</span></span><br><span class="line"></span><br><span class="line">ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLSv1_2)</span><br><span class="line">path_cert = pathlib.Path(__file__).with_name(<span class="string">&quot;cert.pem&quot;</span>)</span><br><span class="line">ssl_context.load_verify_locations(path_cert)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> websockets.connect(</span><br><span class="line">            <span class="string">&#x27;wss://127.0.0.1:8765&#x27;</span>, ssl=ssl_context) <span class="keyword">as</span> websocket:</span><br><span class="line">        name = <span class="built_in">input</span>(<span class="string">&quot;What&#x27;s your name? &quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> websocket.send(name)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;&gt; <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        greeting = <span class="keyword">await</span> websocket.recv()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;&lt; <span class="subst">&#123;greeting&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(hello())</span><br></pre></td></tr></table></figure></li>
<li><p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/61944853/python-websockets-create-pem-file">ssl - Python Websockets create pem file - Stack Overflow</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/24/python%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF/" data-id="cl3k9i3es00004ovkhzf64tf4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="title-Git-HEAD-detached-from-XXX时候的提交如何保存" class="article article-type-title" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/24/Git-HEAD-detached-from-XXX%E6%97%B6%E5%80%99%E7%9A%84%E6%8F%90%E4%BA%A4%E5%A6%82%E4%BD%95%E4%BF%9D%E5%AD%98/" class="article-date">
  <time datetime="2022-05-24T07:29:53.000Z" itemprop="datePublished">2022-05-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/24/Git-HEAD-detached-from-XXX%E6%97%B6%E5%80%99%E7%9A%84%E6%8F%90%E4%BA%A4%E5%A6%82%E4%BD%95%E4%BF%9D%E5%AD%98/">Git HEAD detached from XXX时候的提交如何保存</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Git-HEAD-detached-from-XXX-git-HEAD-游离-解决办法"><a href="#Git-HEAD-detached-from-XXX-git-HEAD-游离-解决办法" class="headerlink" title="Git HEAD detached from XXX (git HEAD 游离) 解决办法"></a>Git HEAD detached from XXX (git HEAD 游离) 解决办法</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011240877/article/details/76273335">Git HEAD detached from XXX (git HEAD 游离) 解决办法_拭心的博客-CSDN博客_detached from</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/24/Git-HEAD-detached-from-XXX%E6%97%B6%E5%80%99%E7%9A%84%E6%8F%90%E4%BA%A4%E5%A6%82%E4%BD%95%E4%BF%9D%E5%AD%98/" data-id="cl3ju8dpx0000q0vk4h5nb6m2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-busybox-httpd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/22/busybox-httpd/" class="article-date">
  <time datetime="2022-05-22T10:15:00.000Z" itemprop="datePublished">2022-05-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/22/busybox-httpd/">busybox httpd</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">busybox httpd -h ./www/data -p <span class="number">8000</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/22/busybox-httpd/" data-id="cl3h5ldjf0000uwvk0krwdpzn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Busybox/" rel="tag">Busybox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/httpd/" rel="tag">httpd</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-百度网盘最新不限速下载方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/22/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E6%9C%80%E6%96%B0%E4%B8%8D%E9%99%90%E9%80%9F%E4%B8%8B%E8%BD%BD%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2022-05-22T08:43:23.000Z" itemprop="datePublished">2022-05-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/22/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E6%9C%80%E6%96%B0%E4%B8%8D%E9%99%90%E9%80%9F%E4%B8%8B%E8%BD%BD%E6%96%B9%E6%B3%95/">百度网盘最新不限速下载方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>2022-05-22测试可用，下载速度达到29MB/s</p>
<ul>
<li><p>浏览器安装tampermonkey</p>
<ul>
<li><p>tampermonkey安装这个脚本：</p>
<p><a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts/418182-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%AE%80%E6%98%93%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B-%E7%9B%B4%E9%93%BE%E4%B8%8B%E8%BD%BD%E5%A4%8D%E6%B4%BB%E7%89%88">百度网盘简易下载助手（直链下载复活版） (greasyfork.org)</a></p>
</li>
</ul>
</li>
<li><p>百度网盘分享链接复制到<a target="_blank" rel="noopener" href="https://jx.jixia.ink/#/jxdo">极下解析 (jixia.ink)</a>里去解析获取直链</p>
<ul>
<li>极下最新网址看这里<a target="_blank" rel="noopener" href="https://wz.jixia.icu/">极下解析 (jixia.icu)</a></li>
</ul>
</li>
<li><p>获取到的直链用IDM下载，UA需要改为netdisk;11.22.2</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/22/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E6%9C%80%E6%96%B0%E4%B8%8D%E9%99%90%E9%80%9F%E4%B8%8B%E8%BD%BD%E6%96%B9%E6%B3%95/" data-id="cl3h23hi900029svk3gv15wir" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%9B%98/" rel="tag">网盘</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-召唤---这个不要" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/20/%E5%8F%AC%E5%94%A4---%E8%BF%99%E4%B8%AA%E4%B8%8D%E8%A6%81/" class="article-date">
  <time datetime="2022-05-20T10:58:22.000Z" itemprop="datePublished">2022-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/20/%E5%8F%AC%E5%94%A4---%E8%BF%99%E4%B8%AA%E4%B8%8D%E8%A6%81/">召唤</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/20/%E5%8F%AC%E5%94%A4---%E8%BF%99%E4%B8%AA%E4%B8%8D%E8%A6%81/" data-id="cl3h23hhy00009svk78z72ev8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/">安卓开发</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arm64/" rel="tag">Arm64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BLOCK-IO/" rel="tag">BLOCK IO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Busybox/" rel="tag">Busybox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag">C语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hello-World/" rel="tag">Hello World</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LINUX-KERNEL/" rel="tag">LINUX KERNEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pycharm/" rel="tag">Pycharm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storage/" rel="tag">Storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/" rel="tag">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/edge/" rel="tag">edge</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/for-test/" rel="tag">for test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftpd/" rel="tag">ftpd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo%E7%AE%A1%E7%90%86/" rel="tag">hexo管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/httpd/" rel="tag">httpd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/" rel="tag">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyinstaller/" rel="tag">pyinstaller</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/" rel="tag">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storage/" rel="tag">storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wss/" rel="tag">wss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%9B%98/" rel="tag">网盘</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Arm64/" style="font-size: 10px;">Arm64</a> <a href="/tags/BLOCK-IO/" style="font-size: 10px;">BLOCK IO</a> <a href="/tags/Busybox/" style="font-size: 10px;">Busybox</a> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">C语言</a> <a href="/tags/Hello-World/" style="font-size: 16.67px;">Hello World</a> <a href="/tags/Java/" style="font-size: 13.33px;">Java</a> <a href="/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/tags/LINUX-KERNEL/" style="font-size: 10px;">LINUX KERNEL</a> <a href="/tags/Pycharm/" style="font-size: 10px;">Pycharm</a> <a href="/tags/Python/" style="font-size: 13.33px;">Python</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/Storage/" style="font-size: 10px;">Storage</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/edge/" style="font-size: 10px;">edge</a> <a href="/tags/for-test/" style="font-size: 10px;">for test</a> <a href="/tags/ftpd/" style="font-size: 10px;">ftpd</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo%E7%AE%A1%E7%90%86/" style="font-size: 10px;">hexo管理</a> <a href="/tags/httpd/" style="font-size: 10px;">httpd</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/pyinstaller/" style="font-size: 10px;">pyinstaller</a> <a href="/tags/python/" style="font-size: 13.33px;">python</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/storage/" style="font-size: 10px;">storage</a> <a href="/tags/websocket/" style="font-size: 13.33px;">websocket</a> <a href="/tags/wss/" style="font-size: 10px;">wss</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 10px;">杂谈</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 10px;">浏览器</a> <a href="/tags/%E7%BD%91%E7%9B%98/" style="font-size: 10px;">网盘</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/09/%E5%AE%89%E5%8D%93%E5%AD%98%E5%82%A8%E6%A0%88/">安卓存储栈</a>
          </li>
        
          <li>
            <a href="/2022/05/29/Linux-kernel-news/">Linux kernel news</a>
          </li>
        
          <li>
            <a href="/2022/05/27/python%E5%BB%BA%E7%AB%8Bsocket-server-websocket-server/">python建立socket server(websocket server)</a>
          </li>
        
          <li>
            <a href="/2022/05/25/Linux%E5%92%8CWindows%E4%B8%8A%E9%9D%A2shell%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%AF%B9%E6%AF%94/">Linux和Windows上面shell基本操作对比</a>
          </li>
        
          <li>
            <a href="/2022/05/24/nodejs%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E4%B8%94%E6%B5%8F%E8%A7%88%E5%99%A8JavaScript%E5%AE%9E%E7%8E%B0wss-secure-websocket-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E4%B9%8B%E9%80%9A%E4%BF%A1/">nodejs实现wss(secure websocket)服务器，且浏览器JavaScript实现wss(secure websocket)客户端与之通信</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>
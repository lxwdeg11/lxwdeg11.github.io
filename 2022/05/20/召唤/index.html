<!DOCTYPE html>
<!-- saved from url=(0121)file:///C:/Users/LXWDE_~1/AppData/Local/Temp/MicrosoftEdgeDownloads/761f5f96-c490-4a5b-b675-0c6035411f24/index%20(1).html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title></title>


</head>
<body background="background_kevin.jpg" id="zhaohuan" style="text-align: center; padding: 5px; background-color:skyblue;">
<textarea align="center" id="input_text" style="width:50px;height:200px;"></textarea>
<br>
<button align="center" style="width:150px;height:200px" onclick="btn_connect()">召唤大狗子</button>
<button align="center" style="width:150px;height:200px" onclick="drink_connect()">喝水</button>
<script type="text/javascript">
		
		var socket;
        function connect(message) {
			var temp=document.getElementById("input_text").value;
			
	
		
		
		
			
			// Create WebSocket connection lxw.
				var times = 0;
				var server_ok = -1;
				var error_times = 0;
				
				console.log(message);
				while (times <= 2) {
					var server_list =new Array(); 
					server_list[0]='ws://192.168.1.3:10000';     
					server_list[1]='ws://222.68.135.141:10000';
					server_list[2]='ws://192.168.3.27:10000';
				//alert(server_list[times]);
				const socket = new WebSocket(server_list[times]);
				
				socket.onerror=function(event){
					error_times++;
					
					if (error_times == 3)
						alert("无法连接到服务器");
					server_ok = 0;
					console.log("Error");
				};			
			
			
				socket.onopen = function(e) {
					server_ok = 1;
					console.log('WebSocket Opened. Sending "Hello"');
					socket.send(message + temp);
					alert('已经发送消息给大狗子');
				  };

				  socket.onmessage = function(e) {
					console.log('Received:', e.data);
				  };
				  




				// Listen for messages
				//如果要指定多个回调函数，可以使用addEventListener方法。
				socket.addEventListener('message', function (event) {

					console.log('Message from server ', event.data);
				});
				if (server_ok == 1)
					break;
				
				times++;
				}


            
        }

        
		function btn_connect() {
			connect("");
		}
		function drink_connect() {
			connect("喝水");
		}
		
</script>





  </body></html>